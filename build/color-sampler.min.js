/*!
 * [color-sampler]{@link https://github.com/emn178/color-sampler}
 *
 * @version 0.1.6
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2015-2016
 * @license MIT
 */
!function(t,e,i){"use strict";function o(e,i){this.canvas=t(e),this.options=i||{},this.enabled=!0,this.context=e.getContext("2d"),this.resize(),this.canvas.on("mousemove",this.onMousemove.bind(this)),this.canvas.on("mouseout",this.onMouseout.bind(this)),this.canvas.on("click",this.onClick.bind(this))}function n(){t(d).each(function(){t(this).data(p).resize()})}function s(){h=t('<div class="color-sampler-preview"/>');var e=t("<table/>");h.append(e);for(var i=0;i<11;++i){for(var o=t("<tr>"),n=0;n<11;++n){var s=t("<td></td>").attr("x",n).attr("y",i);f.push(s),o.append(s)}e.append(o)}t("body").append(h)}function a(){g||(g=!0,h.addClass("active"))}function r(){g&&(g=!1,h.removeClass("active"))}function c(){m=m.filter(d),m.each(function(){t(this).data(p).detect()}),0===m.length&&(l=clearInterval(l))}var h,l,p="color-sampler",d=":"+p,u=5,v=!1,f=[],g=!1,b=200,m=t();t.expr[":"][p]=function(e){return void 0!==t(e).data(p)},o.prototype.resize=function(){var t=this.canvas;this.bounds={left:parseInt(t.css("padding-left"))||0,top:parseInt(t.css("padding-top"))||0,right:t.width(),bottom:t.height()}},o.prototype.onMousemove=function(e){if(this.enabled){var i=this.canvas,o=this.bounds,n=e.offsetX-o.left,s=e.offsetY-o.top;if(this.inRange=this.checkInRange(n,s),!this.inRange&&(n<-u||s<-u||n>=o.right+u||s>=o.bottom+u))return void r();h.css({left:e.pageX+5+"px",top:e.pageY+5+"px"});this.setupPreview(n,s);a(),this.color=f[60].css("background-color"),t.isFunction(this.options.onPreview)&&this.options.onPreview.call(i,this.color),this.canvas.trigger("sampler:preview",this.color)}},o.prototype.setupPreview=function(t,e){for(var i=t-5,o=e-5,n=this.context.getImageData(i,o,11,11).data,s=0,a=0;s<n.length;s+=4,++a){var r=parseInt(a/11)+o,c=a%11+i;if(this.checkInRange(c,r)){var h=Array.prototype.slice.call(n,s,s+4);h[3]=Math.min(h[3]/100,1),h="rgba("+h.join(",")+")",f[a].css("background-color",h)}else f[a].css("background-color","white")}},o.prototype.checkInRange=function(t,e){return t>=0&&e>=0&&t<this.bounds.right&&e<this.bounds.bottom},o.prototype.onMouseout=function(){r()},o.prototype.onClick=function(e){this.color&&this.enabled&&this.inRange&&(t.isFunction(this.options.onSelect)&&this.options.onSelect.call(this.canvas,this.color),this.canvas.trigger("sampler:select",this.color))},o.prototype.detect=function(){this.canvas.width()==this.bounds.right&&this.canvas.height()==this.bounds.bottom||this.resize()},o.prototype.enable=function(t){void 0===t&&(t=!0),this.enabled=t},o.prototype.disable=function(t){void 0===t&&(t=!0),this.enabled=!t,r()};var y=["enable","disable","resize"];t.fn.colorSampler=function(a,r){var h,d="string"==typeof a;return this.filter("canvas").each(function(){d?t.inArray(a,y)!=-1&&(h=t(this).data(p),h&&h[a].apply(h,r)):(r=a,h=new o(this,r),t(this).data(p,h),v||(v=!0,s(),t(i).ready(function(){t(e).bind("resize",n)})),m=m.add(this),b&&!l&&(l=setInterval(c,b)))}),this},t.colorSamper={},t.colorSamper.setInterval=function(e){e==b||!t.isNumeric(e)||e<0||(b=e,l=clearInterval(l),b>0&&(l=setInterval(c,b)))}}(jQuery,window,document);